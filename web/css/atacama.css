e* Base page layout */
body {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    line-height: 1.6;
}

/* Message container */
.message {
    background: white;
    padding: 20px;
    border-radius: 4px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.metadata {
    color: #666;
    margin-bottom: 20px;
    font-size: 0.9em;
}

/* Annotations */
.annotated-chinese {
    position: relative;
    cursor: help;
    /* Add containing block for better positioning context */
    transform: translateZ(0);
    /* Ensure proper layering context */
    isolation: isolate;
}

.annotated-chinese::before,
.annotated-chinese::after {
    /* Initial state - invisible */
    opacity: 0;
    visibility: hidden;
    /* Add transition for smooth appearance/disappearance */
    transition: opacity 0.2s ease, visibility 0.2s ease;
    /* Force hardware acceleration */
    transform: translateX(-50%) translateZ(0);
    /* Prevent any pointer events on tooltips */
    pointer-events: none;
    /* Ensure proper compositing */
    will-change: opacity, visibility;
    position: absolute;
    left: 50%;
    background: #fff;
    border: 1px solid #ddd;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    white-space: nowrap;
}

.annotated-chinese::before {
    content: attr(data-pinyin);
    bottom: calc(100% + 1.6em);
    padding: 4px 8px;
    border-radius: 4px 4px 0 0;
    font-size: 1.2em;
    font-weight: 500;
    z-index: 101;
}

.annotated-chinese::after {
    content: attr(data-definition);
    bottom: 100%;
    padding: 4px 8px;
    border-radius: 0 0 4px 4px;
    font-size: 0.9em;
    color: #666;
    z-index: 100;
}

.annotated-chinese:hover::before,
.annotated-chinese:hover::after {
    opacity: 1;
    visibility: visible;
}

.llm-annotation {
    text-decoration: underline dotted;
    cursor: help;
}

.llm-annotation:hover::after {
    content: attr(data-type);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    padding: 4px 8px;
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 0.9em;
    z-index: 100;
}

/* Lists */
.bullet-list, .number-list, .arrow-list {
    margin: 0.5em 0;
    padding-left: 1em;
    list-style-type: none;
}

.bullet-list::before {
    content: "•";
    margin-right: 0.5em;
}

.number-list::before {
    content: counter(list-item) ".";
    margin-right: 0.5em;
}

.arrow-list::before {
    content: "→";
    margin-right: 0.5em;
}

/* Wikilinks */
.wikilink {
    color: #0645ad;
    text-decoration: none;
    border-bottom: 1px dotted #0645ad;
}

.wikilink:hover {
    text-decoration: none;
    background: #eaf3ff;
}

/* Section break */
hr {
    border: none;
    border-top: 1px solid #ddd;
    margin: 2em 0;
}

/* Sigil styling */
.sigil {
    font-size: 1.2em;
    margin-right: 0.3em;
    vertical-align: middle;
}

/* Base color scheme classes */
p[class^="color-"] {
    margin: 1em 0;
    position: relative;
}

/* Updated color-specific classes */
.color-xantham { 
    color: #A0522D;  /* Lighter brown-red */
    font-style: italic;
}

.color-red { 
    color: #FF4136;
    font-weight: 550;  /* halfway between regular (400) and bold (700) */
}

.color-orange { 
    color: #FF851B;
    border-left: 2px solid #FF851B;
    padding-left: 10px;
}

.color-yellow { 
    color: #B8860B;
    background-color: rgba(255, 255, 0, 0.1);
    font-style: italic;
}

.color-green { 
    color: #097516;
    font-family: "Courier New", Courier, monospace;
    background-color: rgba(0, 255, 0, 0.05);
    font-weight: 550;
}

.color-teal { 
    color: #39CCCC;
    font-family: "Courier New", Courier, monospace;
    border: 1px solid #39CCCC;
    padding: 5px;
    margin: 5px 0;
}

.color-blue { 
    color: #1014E9;
    font-style: italic;
    text-shadow: 0 0 1px rgba(0,116,217,0.2);
    letter-spacing: 0.02em;
}

.color-violet { 
    color: #673AB7;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-size: 0.95em;
}

.color-mogue { 
    color: #310445;
    text-transform: lowercase;
    background: linear-gradient(45deg, rgba(74,0,106,0.05) 0%, rgba(74,0,106,0) 100%);
    padding: 2px 5px;
}

.color-gray { 
    color: #666;
    font-style: italic;
    background: linear-gradient(to right, rgba(0,0,0,0.03), rgba(0,0,0,0));
    padding: 2px 5px;
    border-left: 1px solid #ddd;
    padding-left: 15px;
    margin: 10px 0;
}

.color-hazel {
    color: #8B4513;  /* Saddle brown */
    font-style: italic;
    background: rgba(139,69,19,0.05);
}

/* Literal text blocks */
.literal-text {
    font-family: "Courier New", Courier, monospace;
    background-color: rgba(0, 0, 0, 0.05);
    padding: 0 0.3em;
    border-radius: 2px;
}

/* Print styles */
@media print {
    body {
        max-width: none;
        margin: 0;
        padding: 0.5in;
        font-size: 12pt;
        line-height: 1.5;
    }

    .message {
        box-shadow: none;
        padding: 0;
    }

    /* Ensure annotations print their content */
    .annotated-chinese::after {
        content: " (" attr(data-pinyin) ")";
        font-size: 0.9em;
    }

    .llm-annotation::after {
        content: " [" attr(data-type) "]";
        font-size: 0.9em;
    }

    /* Adjust colors for better print contrast */
    .color-xantham, .color-red, .color-orange, .color-violet, .color-mogue {
        color: black;
    }

    .color-blue, .color-teal, .color-green {
        color: #333;
    }

    /* Print backgrounds for mogue and gray */
    .color-mogue, .color-gray {
        background: #f8f8f8;
    }

    /* Ensure URLs print */
    .wikilink::after {
        content: " (" attr(href) ")";
        font-size: 0.9em;
    }
}
