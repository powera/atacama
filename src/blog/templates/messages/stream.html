{% extends "layouts/" + theme_layout + ".html" %}

{% block title %}{% if current_channel %}{{ current_channel|title }} Channel{% else %}{{ domain_config.name }}{% endif %}{% endblock %}

{% block styles %}
<link rel="stylesheet" href="/css/blog/stream.css">
{% endblock %}

{% block page_title %}
<h1 class="site-title">{% if current_channel %}{{ channel_manager.get_display_name(current_channel) }} Channel{% else %}{{ domain_config.name }}{% endif %}</h1>
{% endblock %}

{% block content %}
    <div class="stream-container">
        <nav class="channel-navigation">
            <div class="primary-nav">
                {% if current_channel %}
                <a href="{{ url_for('content.message_stream') }}" class="channel-link nav-back">
                    ← All Messages
                </a>
                <span class="nav-separator">|</span>
                <span class="nav-current">{{ channel_manager.get_display_name(current_channel) }}</span>
                <span class="nav-separator">|</span>
                <a href="{{ url_for('content.channel_list', channel=current_channel) }}" class="channel-link nav-action">
                    View Index →
                </a>
                {% else %}
                <span class="nav-current">All Messages</span>
                {% endif %}
            </div>
        </nav>
        
    {% for message in messages %}
        <article class="stream-message message">
            <header class="message-header">
                <div class="message-header-main">
                    <a href="{{ url_for('content.get_message', message_id=message.id) }}" class="message-title">
                        {{ message.subject or '(No Subject)' }}
                    </a>
                    {% if message.channel != 'private' %}
                        <span class="message-channel">{{ channel_manager.get_display_name(message.channel) }}</span>
                    {% endif %}
                </div>
                <span class="message-timestamp">{{ message.created_at_formatted }}</span>
            </header>
            <div class="message-body">
                <div class="message-main">
                    {{ (message.preview_content if message.preview_content else message.processed_content) | safe }}
                </div>
                <div class="message-sidebar"></div>
            </div>
        </article>
    {% endfor %}

    {% if has_more %}
    <div class="stream-navigation">
        {% if use_id_pagination %}
            {# Continue using ID-based pagination if that's what was used for this page #}
            {% if current_channel %}
                <a href="{{ url_for('content.message_stream', channel=current_channel, older_than_id=older_than_id) }}" class="navigation-link">Show Older Messages</a>
            {% else %}
                <a href="{{ url_for('content.message_stream', older_than_id=older_than_id) }}" class="navigation-link">Show Older Messages</a>
              {% endif %}
        {% else %}
            {# Use timestamp-based pagination for new style #}
            {% if current_channel %}
                <a href="{{ url_for('content.message_stream', channel=current_channel, tsdate=older_than_tsdate, tstime=older_than_tstime) }}" class="navigation-link">Show Older Messages</a>
            {% else %}
                <a href="{{ url_for('content.message_stream', tsdate=older_than_tsdate, tstime=older_than_tstime) }}" class="navigation-link">Show Older Messages</a>
            {% endif %}
        {% endif %}
    </div>
    {% endif %}
    
</div>
    
{% endblock %}